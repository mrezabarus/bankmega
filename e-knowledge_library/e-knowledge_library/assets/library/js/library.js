var dateFormat=function(){var a=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a};return function(e,f,g){var h=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(e)||/\d/.test(e)||(f=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");f=String(h.masks[f]||f||h.masks["default"]),"UTC:"==f.slice(0,4)&&(f=f.slice(4),g=!0);var i=g?"getUTC":"get",j=e[i+"Date"](),k=e[i+"Day"](),l=e[i+"Month"](),m=e[i+"FullYear"](),n=e[i+"Hours"](),o=e[i+"Minutes"](),p=e[i+"Seconds"](),q=e[i+"Milliseconds"](),r=g?0:e.getTimezoneOffset(),s={d:j,dd:d(j),ddd:h.i18n.dayNames[k],dddd:h.i18n.dayNames[k+7],m:l+1,mm:d(l+1),mmm:h.i18n.monthNames[l],mmmm:h.i18n.monthNames[l+12],yy:String(m).slice(2),yyyy:m,h:n%12||12,hh:d(n%12||12),H:n,HH:d(n),M:o,MM:d(o),s:p,ss:d(p),l:d(q,3),L:d(q>99?Math.round(q/10):q),t:12>n?"a":"p",tt:12>n?"am":"pm",T:12>n?"A":"P",TT:12>n?"AM":"PM",Z:g?"UTC":(String(e).match(b)||[""]).pop().replace(c,""),o:(r>0?"-":"+")+d(100*Math.floor(Math.abs(r)/60)+Math.abs(r)%60,4),S:["th","st","nd","rd"][j%10>3?0:(j%100-j%10!=10)*j%10]};return f.replace(a,function(a){return a in s?s[a]:a.slice(1,a.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(a,b){return dateFormat(this,a,b)},"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};String.prototype.format=String.prototype.format||function(){var a="%",b=new RegExp(["(",a,"(.+?)",a,")"].join(""),"g");return function(a){return this.replace(b,function(b,c,d){return d in a?a[d]:c})}}(),String.prototype.shorten=function(a,b){return a=a||64,b="string"==typeof b?b:"...",this.length<=a?this.toString():this.substr(0,a)+b};var Library=function(a){var b=this,c={dataParts:{CompanyInfo:{},Books:[],Series:[]},id:"",urlName:"",current:{Books:[],sorter:{sorter:"date",order:"asc"},filter:"",collectionUrlId:""},routes:{publicApi:"/Services/PublicAPI.asmx/",ssoBase:""},selectors:{publicationsList:"#publications-list",collectionsList:"#collections-list",allPublicationsLink:"#all-publications-link",companyInfo:"#company-info",companyName:"#company-name",companyLogo:"#company-logo",companyDescription:"#company-description",companySiteLink:"#company-site-link",controls:"#controls",sorter:"#sorter",filter:"#filter",toggleDescription:"#toggle-description",ownerBar:"#owner-bar",toggleOwnerDescription:"#toggle-owner-description",ownerDescription:"#owner-description"},templates:{publication:'<li>	            <a href="%Url%" target="_blank">		            <span class="face">			            <span class="img"><span><img src="%Thumbnail%" alt="%Title%" /></span></span>			            <span class="text">				            <span class="title">%TitleShort%</span>				            <span class="date">%Date%</span>			            </span>		            </span>		            <span class="back">			            <div class="bg"></div>			            <div class="text">				            <span class="desc">%Description%</span>				            <div class="bottom">					            <span class="date">%Date%</span>					            <span class="arr">&rarr;</span>				            </div>			            </div>		            </span>	            </a>            </li>',collection:'<li><a href="%Url%" data-urlid="%UrlId%" id="collection-%UrlId%">%Title%</a></li>'},linkTemplates:[],cache:{},text:{defaultMessage:"There are no publications",libraryIsEmpty:"Your Library does not contain any publications",emptyByFilter:"Please type another value in the filter",emptyCollection:"Collection is empty"}};$.extend(!0,this,{},c,a),b.init(),$$(function(){setTimeout(function(){b.checkForOwner()},700)})};Library.prototype.init=function(){var a=this;window.console&&window.console.log&&console.log("Init!"),a.preloader("show","all");var b=a.getPlatformName();("ios"==b||"android"==b)&&($(document.body).addClass("mobile-device"),"android"==b&&$(a.selectors.sorter).addClass("is-android")),"mac"==b&&$(a.selectors.sorter).addClass("is-mac"),a.getInfo(function(){a.renderLibrary()})},Library.prototype.getInfo=function(a){function b(){d++,d==e.length&&(window.console&&window.console.log&&console.log("All data parts loaded!"),c.trackContent(),a())}var c=this;a=a||function(){};var d=0,e=["CompanyInfo","Series","Books"];c.callWebService({url:c.routes.publicApi+"GetUserDisplayInfo",onSuccess:function(a){a=a.d||a,c.dataParts.CompanyInfo=a,c.linkTemplates=a.LinkTemplates||[],b()}}),c.loadData("GetSeries",{},function(a){a=a.d||a;var d=a.Series||[];b(),c.dataParts.Series=d;var e=null;if(location.hash){e=location.hash.substr(1);for(var f=!1,g=0;g<c.dataParts.Series.length;g++)c.dataParts.Series[g].UrlId==e&&(f=!0,c.current.collectionUrlId=e);f||(e=null)}c.loadData("GetBooks",{request:{Parent:e}},function(a){a=a.d||a;var d=a.Books||[];c.dataParts.Books=d,b()})})},Library.prototype.preloader=function(a,b){a=a||"show",b=b||"all";var c=$('<div class="preloader"/>').addClass("preloader-"+b);"show"==a?$(document.body).append(c).addClass("preloader-"+b):setTimeout(function(){$(document.body).removeClass("preloader-"+b),$("mini"==b?".preloader-"+b:".preloader").fadeOut(function(){$(this).remove()})},1e3)},Library.prototype.loadData=function(a,b,c){var d=this;c=c||function(){},b=b||{};var e="GetBooks"==a;d.callWebService({url:d.routes.publicApi+a,data:b,beforeLoading:e?function(){d.preloader("show","mini")}:function(){},onSuccess:function(a){a=a.d||a,e?(setTimeout(function(){d.preloader("hide","mini")},700),c(a),d.current.Books=a.Books||[]):c(a)},onError:function(a){e||c(a)}})},Library.prototype.callWebService=function(a){function b(b){b=b.d||b,b&&b.Success?a.onSuccess(b):a.onError(b)}var c=this,d={url:"",data:{request:{Identity:{Id:c.id}}},beforeLoading:function(){},onSuccess:function(){},onError:function(){},forced:!0};"string"==typeof a&&(a={url:a}),a=$.extend(!0,{},d,a);var e=JSON.stringify(a.data),f=Base64.encode(e);if(c.cache[f]){var g=c.cache[f];if(g.Success)return b(g),!1}a.beforeLoading(),$.browser.msie&&parseInt($.browser.version)<=9&&(a.url="/AjaxProxy?target="+encodeURIComponent(a.url)),$.ajax({url:a.url,type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:e,dataType:"json",success:function(a){a=a.d||a,c.cache[f]=a,b(a)},error:function(b){b=b.d||b,a.onError(b)}})},Library.prototype.renderLibrary=function(){var a=this;a.renderPublications();var b=$(a.selectors.collectionsList),c=$(a.selectors.allPublicationsLink),d=a.dataParts.Series;c.html(a.dataParts.CompanyInfo.AllPublicationsCaption||"All Publications");for(var e=0;e<d.length;e++){var f=d[e],g=$(a.templates.collection.format({Title:f.Name,Url:f.Url,UrlId:f.UrlId}));b.append(g)}a.current.collectionUrlId&&(b.find("a").removeClass("active"),$("#collection-"+a.current.collectionUrlId).addClass("active"));var h=$(a.selectors.companyInfo),i=$(a.selectors.companyName),j=$(a.selectors.companyLogo),k=$(a.selectors.companyDescription),l=$(a.selectors.companySiteLink),m=a.dataParts.CompanyInfo;if(m.CompanyDescription&&(h.addClass("has-description"),k.html(m.CompanyDescription)),i.html(m.CompanyName||m.UrlName),m.CompanyLogoImages&&(h.addClass("has-logo"),j.attr("src",m.CompanyLogoImages[4].Url)),m.WebSite){h.addClass("has-web-site");var n=/^(?:http:\/\/|https:\/\/)(.+)/.exec(m.WebSite),o=n?m.WebSite:"http://"+m.WebSite,p=n?n[1]:m.WebSite;l.attr("href",o).find(".text").html(p)}a.dataParts.Series.length||$(document.body).addClass("without-sidebar"),a.bindActions(),setTimeout(function(){a.preloader("hide","all")},1500)},Library.prototype.bindActions=function(){var a=this,b=$(a.selectors.collectionsList),c=b.find("a");c.on({click:function(b){b.preventDefault();var d=$(this);if(d.hasClass("active"))return!1;c.removeClass("active"),d.addClass("active");var e=d.data("urlid")||"";a.current.collectionUrlId=e,a.loadData("GetBooks",{request:{Parent:e||null}},function(b){b=b.d||b;var c=b.Books||[];a.renderPublications(c)}),window.location.hash=e}});var d=$(a.selectors.sorter).find("a");d.on({click:function(a){a.preventDefault()},mousedown:function(){d.removeClass("active"),$(this).addClass("active");var b=$(this).hasClass("asc")?"desc":"asc",c=$(this).data("sorter"),e=a.sortItems(c,b);a.current.sorter={sorter:c,order:b},a.renderPublications(e),$(this).toggleClass("asc desc")}});var e=$(a.selectors.filter);e.on("keyup blur",function(){var b=a.filterItems($(this).val());a.renderPublications(b)}).closest("form").on({submit:function(a){a.preventDefault()}});var f=$(a.selectors.toggleDescription);f.on({click:function(b){b.preventDefault(),$(a.selectors.companyInfo).toggleClass("show-description")}}),$(a.selectors.toggleOwnerDescription).on({click:function(b){b.stopPropagation(),$(a.selectors.ownerDescription).toggle()}}),$(document).on({click:function(){$(a.selectors.ownerDescription).hide()}}),$.browser.msie&&parseInt($.browser.version)<=8&&e.on({focus:function(){$(this).val(" "),$(this).val("")}})},Library.prototype.renderPublications=function(a){var b=this;a=a||b.dataParts.Books;var c=$(b.selectors.publicationsList).empty(),d=a;b.current.filter&&(d=b.filterItems(b.current.filter,d)),b.current.sorter&&(d=b.sortItems(b.current.sorter.sorter,b.current.sorter.order,d));var e=b.getLinkTemplate("publicationFriendlyUrlSubdomain")||b.getLinkTemplate("publicationFriendlyUrl");if(e)var f="UrlName";else e=b.getLinkTemplate("publicationUrl"),f="UrlId";if(e=e.replace(/({{|}})/g,"%").replace(/%([a-zA-Z0-9-]+)%/,"%urlId%"),d.length)for(var g=0;g<d.length;g++){var h=d[g],i=new Date(parseInt((h.IssueDate||h.CreationDate).replace(/[^\d]/g,""))),j=$(b.templates.publication.format({Title:h.Name,TitleShort:h.Name.shorten(30),Thumbnail:h.ThumbnailInfos[1].Url,Date:i.format("yyyy | mmm dd"),Description:(h.Description||h.Name).shorten(190),Url:e.format({urlId:h[f]})}));c.append(j)}setTimeout(function(){b.checkOnEmpty()},100)},Library.prototype.sortItems=function(a,b,c){var d=this;c=c||d.current.Books;var e={date:function(a,b){function c(a){return a?parseInt(a.replace(/[^\d|-]/g,"")):0}return a=c(a.IssueDate||a.CreationDate),b=c(b.IssueDate||b.CreationDate),a>b?1:a==b?0:-1},name:function(a,b){return a=a.Name?$.trim(a.Name.toLowerCase()):"",b=b.Name?$.trim(b.Name.toLowerCase()):"",a>b?1:a==b?0:-1}},f=c.sort(e[a]);return"desc"==b?f:f.reverse()},Library.prototype.filterItems=function(a,b){var c=this;if(b=b||c.current.Books,a=(a||"").toLowerCase(),c.current.filter=a,!a)return b;for(var d=[],e=0;e<b.length;e++){var f=b[e],g=f.Name.toLowerCase(),h=(f.Description||"").toLowerCase();(g.indexOf(a)>=0||h.indexOf(a)>=0)&&d.push(f)}return d},Library.prototype.checkOnEmpty=function(){var a=this,b=$(a.selectors.publicationsList),c=b.children().length,d=$(a.selectors.controls);if($(".empty").remove(),0==c){var e=a.text.defaultMessage;a.current.collectionUrlId?a.current.Books.length?a.current.filter&&(e=a.text.emptyByFilter):e=a.text.emptyCollection:a.dataParts.Books.length?a.current.filter&&(e=a.text.emptyByFilter):e=a.text.libraryIsEmpty,e!=a.text.emptyByFilter&&d.css("visibility","hidden");var f=$('<div class="empty" />').html(e);f.insertBefore(b)}else d.css("visibility","visible"),$(".empty").remove()},Library.prototype.checkForOwner=function(){function a(a){return a.Superuser&&a.Superuser.IsSelf&&a.Superuser.UrlName==c.urlName}function b(b){window.console&&window.console.log&&console.log(c.routes.frontendApi+"/GetUserInfo"),c.callWebService({url:c.routes.frontendApi+"/GetUserInfo",data:{accessToken:b},onSuccess:function(b){b=b.d||b,a(b)?$(c.selectors.ownerBar).addClass("is-owner"):$(c.selectors.ownerBar).remove()},onError:function(){$(c.selectors.ownerBar).remove()}})}var c=this;window.console&&window.console.log&&console.log(Login.accessToken),Login.accessToken?b(Login.accessToken):$(c.selectors.ownerBar).remove()},Library.prototype.getHash=function(a){a=a||!1;for(var b=location.hash&&location.hash.substr(1),c=b.split("&"),d={},e=0;e<c.length;e++)if(c[e]){var f=c[e].split("=");d[f[0]]=f[1]}return a?d[a]||!1:d},Library.prototype.getLinkTemplate=function(a){var b=this,c={publicationUrl:17,collectionUrl:65,publicationFriendlyUrl:10,collectionFriendlyUrl:34,publicationFriendlyUrlSubdomain:12,collectionFriendlyUrlSubdomain:36};a=c[a];var d="";return $.each(b.linkTemplates,function(b,c){c.LinkParts==a&&(d=c.Template)}),d},Library.prototype.getPlatformName=function(){var a=navigator.userAgent.toLowerCase(),b=navigator.platform.toLowerCase();return a.match(/ip(?:ad|od|hone)/)?"ios":a.match(/(?:msie 9)/)?"wphone":(a.match(/(?:webos|android|bada|symbian|palm|blackberry)/)||b.match(/mac|win|linux/)||["other"])[0]},Library.prototype.trackContent=function(){var a=this;if(location.hash)return!1;try{var b=a.dataParts.Books.length,c=a.dataParts.Series.length;window.console&&window.console.log&&(console.log("Content tracked!"),console.log("Total publications: ",b),console.log("Total collections: ",c));var d=b;ga("set","dimension1",d);var e=c;ga("set","dimension2",e);var f=b;ga("set","metric1",f);var g=c;ga("set","metric2",g)}catch(h){}},!function(a){function b(){var a=document.createElement("smartbanner"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}var c=function(b){this.origHtmlMargin=parseFloat(a("html").css("margin-top")),this.options=a.extend({},a.smartbanner.defaults,b);var c=navigator.standalone,d=navigator.userAgent;if(this.options.force?this.type=this.options.force:null!=d.match(/Android/i)&&(this.type="android"),this.type&&!c&&!this.getCookie("sb-closed")&&!this.getCookie("sb-installed")){this.scale="auto"==this.options.scale?a(window).width()/window.screen.width:this.options.scale,this.scale<1&&(this.scale=1);var e=a('meta[name="google-play-app"]');this.appId=/app-id=([^\s,]+)/.exec(e.attr("content"))[1],this.title=this.options.title?this.options.title:e.data("title")||a("title").text().replace(/\s*[|\-Â·].*$/,""),this.iconUrl=e.data("icon-url"),this.create(),this.show(),this.listen()}};c.prototype={constructor:c,create:function(){var b,c=this.options.url?this.options.url:"market://details?id="+this.appId,d=null===this.options.iconGloss?!1:this.options.iconGloss;this.options.url?c=this.options.url:"android"==this.type&&(c="market://details?id="+this.appId,this.options.GooglePlayParams&&(c=c+"&referrer="+this.options.GooglePlayParams));var e='<div id="smartbanner" class="'+this.type+'"><div class="sb-container"><a href="#" class="sb-close">&times;</a><span class="sb-icon"></span><div class="sb-info"><strong>'+this.title+'</strong></div><a href="'+c+'" class="sb-button"><span>'+this.options.button+"</span></a></div></div>";this.options.layer?a(this.options.appendToSelector).append(e):a(this.options.appendToSelector).prepend(e),this.options.icon?b=this.options.icon:this.iconUrl&&(b=this.iconUrl),b?(a("#smartbanner .sb-icon").css("background-image","url("+b+")"),d&&a("#smartbanner .sb-icon").addClass("gloss")):a("#smartbanner").addClass("no-icon"),this.bannerHeight=a("#smartbanner").outerHeight()+2,this.scale>1&&(a("#smartbanner").css("top",parseFloat(a("#smartbanner").css("top"))*this.scale).css("height",parseFloat(a("#smartbanner").css("height"))*this.scale).hide(),a("#smartbanner .sb-container").css("-webkit-transform","scale("+this.scale+")").css("-msie-transform","scale("+this.scale+")").css("-moz-transform","scale("+this.scale+")").css("width",a(window).width()/this.scale)),a("#smartbanner").css("position",this.options.layer?"absolute":"static")},listen:function(){a("#smartbanner .sb-close").on("click",a.proxy(this.close,this)),a("#smartbanner .sb-button").on("click",a.proxy(this.install,this))},show:function(b){var c=a("#smartbanner");if(c.stop(),this.options.layer)c.animate({top:0,display:"block"},this.options.speedIn).addClass("shown").show(),a("html").animate({marginTop:this.origHtmlMargin+this.bannerHeight*this.scale},this.options.speedIn,"swing",b);else if(a.support.transition){c.animate({top:0},this.options.speedIn).addClass("shown");var d=function(){a("html").removeClass("sb-animation"),b&&b()};a("html").addClass("sb-animation").one(a.support.transition.end,d).emulateTransitionEnd(this.options.speedIn).css("margin-top",this.origHtmlMargin+this.bannerHeight*this.scale)}else c.slideDown(this.options.speedIn).addClass("shown")},hide:function(b){var c=a("#smartbanner");if(c.stop(),this.options.layer)c.animate({top:-1*this.bannerHeight*this.scale,display:"block"},this.options.speedIn).removeClass("shown"),a("html").animate({marginTop:this.origHtmlMargin},this.options.speedIn,"swing",b);else if(a.support.transition){c.css("top",-1*this.bannerHeight*this.scale).removeClass("shown");var d=function(){a("html").removeClass("sb-animation"),b&&b()};a("html").addClass("sb-animation").one(a.support.transition.end,d).emulateTransitionEnd(this.options.speedOut).css("margin-top",this.origHtmlMargin)}else c.slideUp(this.options.speedOut).removeClass("shown")},close:function(a){a.preventDefault(),this.hide(),this.setCookie("sb-closed","true",this.options.daysHidden)},install:function(){this.options.hideOnInstall&&this.hide(),this.setCookie("sb-installed","true",this.options.daysReminder)},setCookie:function(a,b,c){var d=new Date;d.setDate(d.getDate()+c),b=encodeURI(b)+(null==c?"":"; expires="+d.toUTCString()),document.cookie=a+"="+b+"; path=/;"},getCookie:function(a){var b,c,d,e=document.cookie.split(";");for(b=0;b<e.length;b++)if(c=e[b].substr(0,e[b].indexOf("=")),d=e[b].substr(e[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return decodeURI(d);return null}},a.smartbanner=function(b){var d=a(window),e=d.data("smartbanner"),f="object"==typeof b&&b;e||d.data("smartbanner",e=new c(f)),"string"==typeof b&&e[b]()},a.smartbanner.defaults={title:null,GooglePlayParams:null,icon:null,iconGloss:null,button:"VIEW",url:null,scale:"auto",speedIn:300,speedOut:400,daysHidden:15,daysReminder:90,force:null,hideOnInstall:!0,layer:!0,appendToSelector:"body"},a.smartbanner.Constructor=c,void 0===a.support.transition&&(a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()}))}(window.jQuery);